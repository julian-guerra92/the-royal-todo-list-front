<div class="modal" [class.modal-open]="isVisible()">
  <div class="modal-box w-11/12 max-w-2xl">
    <div class="flex justify-between items-center mb-6">
      <h3 class="font-bold text-lg">
        {{ isEditMode() ? 'Edit Todo' : 'Create New Todo' }}
      </h3>
      <button
        type="button"
        class="btn btn-sm btn-circle btn-ghost"
        (click)="onCancelClick()">
        âœ•
      </button>
    </div>

    <form [formGroup]="todoForm" (ngSubmit)="onFormSubmit()" class="space-y-6">

      <div class="form-control w-full">
        <label class="label">
          <span class="label-text font-medium">Title *</span>
          <span class="label-text-alt text-gray-500">{{ todoForm.get('title')?.value?.length || 0 }}/100</span>
        </label>
        <input
          type="text"
          formControlName="title"
          placeholder="Enter a brief summary of your task"
          class="input input-bordered w-full"
          [class.input-error]="todoForm.get('title')?.invalid && todoForm.get('title')?.touched"
          maxlength="100">
        <label class="label" *ngIf="getFieldError('title')">
          <span class="label-text-alt text-error">{{ getFieldError('title') }}</span>
        </label>
      </div>

      <div class="form-control w-full">
        <label class="label">
          <span class="label-text font-medium">Content *</span>
          <span class="label-text-alt text-gray-500">{{ todoForm.get('content')?.value?.length || 0 }}/500</span>
        </label>
        <textarea
          formControlName="content"
          placeholder="Provide a detailed description of your task"
          class="textarea textarea-bordered h-24 w-full resize-none"
          [class.textarea-error]="todoForm.get('content')?.invalid && todoForm.get('content')?.touched"
          maxlength="500"></textarea>
        <label class="label" *ngIf="getFieldError('content')">
          <span class="label-text-alt text-error">{{ getFieldError('content') }}</span>
        </label>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-medium">Date *</span>
          </label>
          <div class="relative">
            <input
              type="date"
              formControlName="date"
              class="input input-bordered w-full pr-10"
              [class.input-error]="todoForm.get('date')?.invalid && todoForm.get('date')?.touched"
              [min]="getCurrentDate()">
            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
              <svg class="w-5 h-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
              </svg>
            </div>
          </div>
          <label class="label" *ngIf="getFieldError('date')">
            <span class="label-text-alt text-error">{{ getFieldError('date') }}</span>
          </label>
        </div>

        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-medium">Priority *</span>
            <span class="label-text-alt text-gray-500">1 (Low) - 10 (High)</span>
          </label>
          <div class="flex items-center space-x-3">
            <input
              type="range"
              formControlName="priority"
              min="1"
              max="10"
              class="range range-primary flex-1"
              [class.range-error]="todoForm.get('priority')?.invalid && todoForm.get('priority')?.touched">
            <div class="badge badge-primary badge-lg font-bold min-w-[3rem]">
              {{ todoForm.get('priority')?.value || 1 }}
            </div>
          </div>
          <div class="flex w-full justify-between text-xs px-2 mt-1 text-gray-500">
            <span>1</span>
            <span>2</span>
            <span>3</span>
            <span>4</span>
            <span>5</span>
            <span>6</span>
            <span>7</span>
            <span>8</span>
            <span>9</span>
            <span>10</span>
          </div>
          <label class="label" *ngIf="getFieldError('priority')">
            <span class="label-text-alt text-error">{{ getFieldError('priority') }}</span>
          </label>
        </div>

      </div>

      <div class="modal-action">
        <button
          type="button"
          class="btn btn-ghost"
          (click)="onCancelClick()">
          Cancel
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="todoForm.invalid">
          <span *ngIf="!isEditMode()">Create Todo</span>
          <span *ngIf="isEditMode()">Update Todo</span>
        </button>
      </div>

    </form>
  </div>

  <div class="modal-backdrop" (click)="onCancelClick()"></div>
</div>
